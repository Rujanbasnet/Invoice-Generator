<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invoices â€” InvoicePro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="css/modern-ui.css">
  <script src="js/data-manager.js"></script>
  <script src="js/sidebarTemplate.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>

<body class="antialiased bg-slate-50">

  <div class="flex min-h-screen">
    <script>injectSidebar('invoices');</script>

    <main class="flex-1 flex flex-col">
      <header class="modern-topbar flex items-center justify-between px-8 py-4 sticky top-0 z-20">
        <div>
          <h2 class="text-2xl font-bold text-slate-800">Invoices</h2>
          <p class="text-sm text-slate-500">Track payments and revenue</p>
        </div>
        <div class="flex gap-3">
          <a href="create-invoice.html" class="primary-action">
            <i class="fa-solid fa-plus"></i> New Invoice
          </a>
        </div>
      </header>

      <section class="flex-1 overflow-y-auto p-8">
        <div class="max-w-7xl mx-auto space-y-6">

          <!-- Filter Tabs -->
          <div class="flex items-center gap-2 border-b border-slate-200 pb-1">
            <button
              class="filter-tab px-4 py-2 text-sm font-medium text-slate-500 hover:text-blue-600 border-b-2 border-transparent transition-all"
              data-filter="all">All Invoices</button>
            <button
              class="filter-tab px-4 py-2 text-sm font-medium text-slate-500 hover:text-blue-600 border-b-2 border-transparent transition-all"
              data-filter="paid">Paid</button>
            <button
              class="filter-tab px-4 py-2 text-sm font-medium text-slate-500 hover:text-blue-600 border-b-2 border-transparent transition-all"
              data-filter="pending">Pending</button>
            <button
              class="filter-tab px-4 py-2 text-sm font-medium text-slate-500 hover:text-blue-600 border-b-2 border-transparent transition-all"
              data-filter="overdue">Overdue</button>
          </div>

          <div class="surface-card overflow-hidden">
            <table class="modern-table text-sm">
              <thead>
                <tr>
                  <th class="text-left pl-6">Invoice #</th>
                  <th class="text-left">Client</th>
                  <th class="text-left">Date</th>
                  <th class="text-left">Due Date</th>
                  <th class="text-left">Amount</th>
                  <th class="text-left">Status</th>
                  <th class="text-right pr-6">Actions</th>
                </tr>
              </thead>
              <tbody id="invoicesTableBody">
                <!-- Injected via JS -->
              </tbody>
            </table>
          </div>

        </div>
      </section>
    </main>
  </div>

  <script src="js/sidebar.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const invoices = DataManager.getInvoices();
      const tbody = document.getElementById('invoicesTableBody');
      const tabs = document.querySelectorAll('.filter-tab');

      // Get filter from URL
      const urlParams = new URLSearchParams(window.location.search);
      const initialFilter = urlParams.get('status') || 'all';

      // Init
      setActiveTab(initialFilter);
      renderInvoices(initialFilter);

      // Tab Click Events
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const filter = tab.dataset.filter;
          setActiveTab(filter);
          renderInvoices(filter);

          // Update URL without reload
          const newUrl = new URL(window.location);
          newUrl.searchParams.set('status', filter);
          window.history.pushState({}, '', newUrl);
        });
      });

      function setActiveTab(filter) {
        tabs.forEach(t => {
          if (t.dataset.filter === filter) {
            t.classList.add('text-blue-600', 'border-blue-600');
            t.classList.remove('text-slate-500', 'border-transparent');
          } else {
            t.classList.remove('text-blue-600', 'border-blue-600');
            t.classList.add('text-slate-500', 'border-transparent');
          }
        });
      }

      function renderInvoices(filter) {
        tbody.innerHTML = '';

        const filtered = invoices.filter(inv => {
          if (filter === 'all') return true;
          return inv.status.toLowerCase() === filter.toLowerCase();
        });

        if (filtered.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-8 text-center text-slate-500">No invoices found.</td></tr>';
          return;
        }

        filtered.forEach(inv => {
          const variant = inv.status.toLowerCase();
          const row = document.createElement('tr');

          // Chase button only for overdue/pending
          const showChase = inv.status !== 'Paid';

          row.innerHTML = `
            <td class="pl-6 font-medium text-slate-900">${inv.id}</td>
            <td class="text-slate-700 font-medium">${inv.clientName}</td>
            <td class="text-slate-600">${inv.date}</td>
            <td class="text-slate-500">${inv.dueDate}</td>
            <td class="text-slate-900 font-bold">${DataManager.formatMoney(inv.amount)}</td>
            <td><span class="status-pill" data-variant="${variant}">${inv.status}</span></td>
            <td class="pr-6 text-right">
              <div class="flex items-center justify-end gap-2">
                ${showChase ? `
                <button onclick="chasePayment('${inv.id}')" class="text-xs bg-rose-50 text-rose-600 px-2 py-1 rounded-lg hover:bg-rose-100 transition-colors" title="Send Reminder">
                  <i class="fa-solid fa-bell"></i> Chase
                </button>` : ''}
                <button onclick="downloadInvoice('${inv.id}')" class="text-slate-400 hover:text-emerald-600 transition-colors" title="Download PDF"><i class="fa-solid fa-download"></i></button>
                <button onclick="viewInvoice('${inv.id}')" class="text-slate-400 hover:text-blue-600 transition-colors" title="View Invoice"><i class="fa-solid fa-eye"></i></button>
              </div>
            </td>
          `;
          tbody.appendChild(row);
        });
      }
    });

    function chasePayment(id) {
      const btn = event.currentTarget;
      btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
      btn.disabled = true;
      setTimeout(() => {
        btn.innerHTML = `<i class="fa-solid fa-check"></i> Sent`;
        btn.classList.replace('bg-rose-50', 'bg-emerald-50');
        btn.classList.replace('text-rose-600', 'text-emerald-600');
        alert(`Payment reminder sent for ${id}`);
      }, 1500);
    }

    function viewInvoice(id) {
      alert(`Viewing Invoice ${id}\n(In a real app, this would open a modal or detailed view)`);
    }

    function downloadInvoice(id) {
      alert(`Downloading Invoice ${id} as PDF...`);
    }
  </script>
</body>

</html>